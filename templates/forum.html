{% extends 'base.html' %}

{% block content %}
<style>
    /* ESTILOS ESPEC√çFICOS DO F√ìRUM */
    .feed-container { max-width: 600px; margin: 0 auto; border-left: 1px solid #333; border-right: 1px solid #333; min-height: 100vh; text-align: left;}
    
    /* √Årea de Criar Post */
    .create-post-box { padding: 15px; border-bottom: 1px solid #333; display: flex; gap: 10px; }
    .post-input-area { flex: 1; }
    
    /* Filtros e Busca */
    .filter-bar { display: flex; justify-content: space-between; padding: 10px 15px; border-bottom: 1px solid #333; align-items: center; backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; background: rgba(0,0,0,0.8); }
    .search-input { background: #202327; border: none; padding: 8px 20px; border-radius: 20px; color: white; width: 200px; }
    
    /* Card do Post */
    .post-card { padding: 15px; border-bottom: 1px solid #333; display: flex; gap: 12px; cursor: pointer; transition: background 0.2s; text-decoration: none; color: inherit; }
    .post-card:hover { background: rgba(255,255,255,0.03); }
    
    /* Foto de Perfil e Bordas */
    .avatar-wrapper { position: relative; }
    .avatar-img { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }
    
    /* ESTILO DO MENTOR (Dourado Brilhante) */
    .mentor-border { 
        border: 2px solid #FFD700; 
        box-shadow: 0 0 8px rgba(255, 215, 0, 0.6); 
    }
    .mentor-badge {
        color: #FFD700;
        background: rgba(255, 215, 0, 0.1);
        font-size: 0.75em;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 5px;
        border: 1px solid #FFD700;
        font-weight: bold;
        text-transform: uppercase;
    }

    /* A√ß√µes do Post (Like, Comentar) */
    .post-actions { display: flex; justify-content: space-between; max-width: 80%; margin-top: 10px; color: #71767b; }
    .action-btn { background: none; border: none; color: inherit; cursor: pointer; display: flex; align-items: center; gap: 5px; transition: color 0.2s; }
    .action-btn:hover.like { color: #f91880; }
    .action-btn:hover.comment { color: #1d9bf0; }
    .liked { color: #f91880 !important; }

</style>

<div class="feed-container">
    
    <div class="filter-bar">
        <h2 style="margin: 0; font-size: 1.2em;">F√≥rum</h2>
        
        <form method="GET" style="display: flex; gap: 10px;">
            <input type="text" name="q" placeholder="Buscar..." class="search-input" value="{{ request.GET.q|default:'' }}">
            
            <select name="ordem" onchange="this.form.submit()" style="background: #202327; color: white; border: none; border-radius: 20px; padding: 5px 10px;">
                <option value="recentes" {% if request.GET.ordem != 'curtidos' %}selected{% endif %}>Mais Recentes</option>
                <option value="curtidos" {% if request.GET.ordem == 'curtidos' %}selected{% endif %}>Mais Curtidos</option>
            </select>
            
            <select name="filtro_autor" onchange="this.form.submit()" style="background: #202327; color: white; border: none; border-radius: 20px; padding: 5px 10px;">
                <option value="">Todos</option>
                <option value="mentores" {% if request.GET.filtro_autor == 'mentores' %}selected{% endif %}>S√≥ Mentores</option>
                <option value="alunos" {% if request.GET.filtro_autor == 'alunos' %}selected{% endif %}>S√≥ Alunos</option>
            </select>
        </form>
    </div>

    <div class="create-post-box">
        <img src="{{ user.perfil.foto.url }}" class="avatar-img {% if user.perfil.tipo == 'Mentor' %}mentor-border{% endif %}">
        <div class="post-input-area">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.conteudo }}
                
                <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #333; padding-top: 10px;">
                    <label for="file-input" style="cursor: pointer; color: #1d9bf0;">
                        üì∑ <span style="font-size: 0.9em;">Adicionar Foto</span>
                    </label>
                    {{ form.imagem }}
                    <button type="submit" class="btn btn-primary" style="border-radius: 20px; padding: 5px 20px;">Publicar</button>
                </div>
            </form>
        </div>
    </div>

    {% for post in posts %}
    <a href="{% url 'post_detail' post.id %}" class="post-card">
        
        <div class="avatar-wrapper">
            <object>
                <a href="{% url 'perfil_publico' post.autor.username %}">
                    <img src="{{ post.autor.perfil.foto.url }}" class="avatar-img {% if post.autor.perfil.tipo == 'Mentor' %}mentor-border{% endif %}">
                </a>
            </object>
        </div>

        <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 5px;">
                <strong style="color: white;">{{ post.autor.username }}</strong>
                
                {% if post.autor.perfil.tipo == 'Mentor' %}
                    <span class="mentor-badge">Mentor</span>
                {% endif %}
                
                <span style="color: #71767b; font-size: 0.9em;">‚Ä¢ {{ post.data_criacao|timesince }} atr√°s</span>
            </div>

            <p style="margin: 5px 0; color: #e7e9ea; white-space: pre-line;">{{ post.conteudo }}</p>

            {% if post.imagem %}
                <img src="{{ post.imagem.url }}" style="width: 100%; border-radius: 15px; margin-top: 10px; border: 1px solid #333;">
            {% endif %}

            <div class="post-actions">
                <div class="action-btn comment">
                    üí¨ {{ post.comentarios.count }}
                </div>

                <object>
                    <a href="{% url 'dar_like' post.id %}" class="action-btn like {% if request.user in post.likes.all %}liked{% endif %}">
                        {% if request.user in post.likes.all %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
                        {{ post.total_likes }}
                    </a>
                </object>
            </div>
        </div>
    </a>
    {% empty %}
        <div style="text-align: center; padding: 40px; color: #71767b;">
            <h3>Nenhum post encontrado ü¶ó</h3>
            <p>Seja o primeiro a publicar algo!</p>
        </div>
    {% endfor %}

</div>
{% endblock %}